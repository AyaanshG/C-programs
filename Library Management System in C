#include <stdio.h>
#include<string.h>
int main() {
    char book[100], author[100];
    int state;
    int total;
    char line[200];
    int changed = 0;   
    int t=0; // total no. of books
    // Bold header using ANSI escape codes
    printf("\033[1m                   LIBRARY SYSTEM                   \033[0m\n");

    // Ask user for action
    printf("Are you adding[1] or issuing[2] a book? Please write only the number here: ");
    scanf("%d", &state);

    if (state == 1) {
        // Prompt for book name
        printf(" Write the name of the book with proper capitalization: ");
        scanf(" %99[^\n]%*c", book); // Reads until newline and discards it

        // Prompt for author name
        printf(" Write the author's name with proper capitalization: ");
        scanf(" %99[^\n]%*c", author);

        // Open file in append mode
        FILE *fptr = fopen("lib.txt", "a");
        if (fptr == NULL) {
            printf("Error opening file!\n");
            return 1;
        }

        // Write book and author to file
        fprintf(fptr, "NOT ISSUED: %s, %s\n", book, author);
        fclose(fptr);

        printf(" Book added successfully!\n");
    } else if (state == 2) {
        
       // Prompt for book name
        printf(" Write the name of the book with proper capitalization: ");
        scanf(" %99[^\n]%*c", book); // Reads until newline and discards it

        // Prompt for author name
        printf(" Write the author's name with proper capitalization: ");
        scanf(" %99[^\n]%*c", author);

FILE *old = fopen("lib.txt", "r");
    FILE *new = fopen("temp.txt", "w");
    if (!old || !new) {
        printf("File error.\n");
        return 1;
    }

    char line[200];
    int changed = 0;

    while (fgets(line, sizeof(line), old)) {
        if (!changed && strstr(line, "NOT ISSUED:") && strstr(line, book) && strstr(line, author))//strstr looks for the second part in the first part(haystack, needle) 
        {
            fprintf(new, "ISSUED: %s, %s\n", book, author);
            changed = 1;
        } else {
            fputs(line, new);
        }
        if (strstr(line, "NOT ISSUED:"))
    {
        t++;
    }
    
    }
    printf("\nTotal number of books in library: %d\n", t);

    fclose(old);
    fclose(new);
    remove("lib.txt");
    rename("temp.txt", "lib.txt");

    if (changed==1)
        printf("Book issued!\n");
    else
        printf("Book not found.\n");

    } else {
        printf(" Invalid option. Please enter 1 or 2.\n");
    }
  return 0;  
}
    
